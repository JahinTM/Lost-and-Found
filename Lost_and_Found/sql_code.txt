-- ===============================
-- CREATE USER
-- ===============================
CREATE USER c##lostfound IDENTIFIED BY lostfound;

-- ===============================
-- BASIC PRIVILEGES
-- ===============================
GRANT CONNECT, RESOURCE TO c##lostfound;
GRANT CREATE SESSION TO c##lostfound;
GRANT CREATE TABLE TO c##lostfound;
GRANT CREATE VIEW TO c##lostfound;
GRANT CREATE SEQUENCE TO c##lostfound;
GRANT CREATE TRIGGER TO c##lostfound;
GRANT CREATE PROCEDURE TO c##lostfound;
GRANT CREATE SYNONYM TO c##lostfound;

-- ===============================
-- STORAGE QUOTA
-- ===============================
ALTER USER c##lostfound QUOTA UNLIMITED ON USERS;



CONNECT c##lostfound/lostfound;


CREATE TABLE Users (
    user_id        NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    user_name      VARCHAR2(100) NOT NULL,
    std_id         VARCHAR2(20),
    user_type      VARCHAR2(20)
                   CHECK (user_type IN ('Student', 'Admin')),
    user_password  VARCHAR2(50) NOT NULL
);


CREATE TABLE Report (
    report_id       NUMBER PRIMARY KEY,
    item            VARCHAR2(100) NOT NULL,
    report_date     DATE DEFAULT SYSDATE,
    reporter_id     VARCHAR2(20),
    floor_no        VARCHAR2(10),
    specific_place  VARCHAR2(100),
    status          VARCHAR2(20) DEFAULT 'Pending'
);

CREATE SEQUENCE report_seq
START WITH 1
INCREMENT BY 1
NOCACHE;

CREATE OR REPLACE TRIGGER report_trigger
BEFORE INSERT ON Report
FOR EACH ROW
BEGIN
    IF :NEW.report_id IS NULL THEN
        SELECT report_seq.NEXTVAL
        INTO :NEW.report_id
        FROM dual;
    END IF;
END;
/


CREATE TABLE ContactMessages (
    message_id       NUMBER PRIMARY KEY,
    report_id        NUMBER NOT NULL,
    student_id       VARCHAR2(20) NOT NULL,
    contact_number   VARCHAR2(20) NOT NULL,
    details          VARCHAR2(500),
    message_date     DATE DEFAULT SYSDATE,
    status           VARCHAR2(20) DEFAULT 'Pending'
);


CREATE SEQUENCE message_seq
START WITH 1
INCREMENT BY 1
NOCACHE;

CREATE OR REPLACE TRIGGER message_trigger
BEFORE INSERT ON ContactMessages
FOR EACH ROW
BEGIN
    IF :NEW.message_id IS NULL THEN
        SELECT message_seq.NEXTVAL
        INTO :NEW.message_id
        FROM dual;
    END IF;
END;
/


CREATE TABLE Claim (
    claim_id   NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    report_id  NUMBER NOT NULL,
    user_id    NUMBER NOT NULL,
    status     VARCHAR2(20)
               CHECK (status IN ('Pending', 'Approved', 'Rejected')),

    CONSTRAINT fk_claim_report
        FOREIGN KEY (report_id)
        REFERENCES Report(report_id),

    CONSTRAINT fk_claim_user
        FOREIGN KEY (user_id)
        REFERENCES Users(user_id)
);


COMMIT;


SET LINESIZE 200
SET PAGESIZE 100

COLUMN user_name FORMAT A20
COLUMN std_id FORMAT A15
COLUMN item FORMAT A20
COLUMN specific_place FORMAT A25
COLUMN details FORMAT A40



